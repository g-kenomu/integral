<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>

</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>積分マスター V3</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .katex-display { margin: 0.5em 0; overflow-x: auto; overflow-y: hidden; }
        .tap-highlight-transparent { -webkit-tap-highlight-color: transparent; }
        
        /* 難問モード用の赤黒テーマ */
        .theme-hard {
            --bg-color: #1a0505;
            --text-color: #fca5a5;
            --card-bg: #2b0b0b;
            --accent: #ef4444;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 transition-colors duration-500">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Math Engine & Generators ---
        class Seeder {
            constructor(seedStr) {
                let h = 2166136261 >>> 0;
                for (let i = 0; i < seedStr.length; i++) {
                    h = Math.imul(h ^ seedStr.charCodeAt(i), 16777619);
                }
                this.seed = h;
            }
            random() {
                let t = this.seed += 0x6D2B79F5;
                t = Math.imul(t ^ t >>> 15, t | 1);
                t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            }
        }

        const getRandomInt = (min, max, rng = Math.random) => {
            return Math.floor(rng() * (max - min + 1)) + min;
        };

        // --- 通常問題 (Normal) ---
        const normalGenerators = [
            (rng) => { // (ax+b)^n
                const a = getRandomInt(2, 5, rng) * (rng() > 0.5 ? 1 : -1);
                const b = getRandomInt(1, 9, rng) * (rng() > 0.5 ? 1 : -1);
                const n = getRandomInt(2, 5, rng);
                const bStr = b > 0 ? `+${b}` : `${b}`;
                return {
                    id: `n1-${Date.now()}`,
                    type: "基本",
                    latex: `\\int (${a}x ${bStr})^{${n}} \\, dx`,
                    hint: `塊の積分。\\((ax+b)^n\\) の形。\\(\\frac{1}{a}\\) を忘れずに。`,
                    answer: `\\frac{1}{${Math.abs(a*(n+1))}} (${a}x ${bStr})^{${n+1}} + C`
                };
            },
            (rng) => { // sin/cos
                const a = getRandomInt(2, 5, rng);
                const isSin = rng() > 0.5;
                const func = isSin ? "sin" : "cos";
                return {
                    id: `n2-${Date.now()}`,
                    type: "三角関数",
                    latex: `\\int \\${func}(${a}x) \\, dx`,
                    hint: `角度が \\(${a}x\\) なので、係数 \\(\\frac{1}{${a}}\\) が出ます。符号に注意。`,
                    answer: isSin ? `-\\frac{1}{${a}} \\cos(${a}x) + C` : `\\frac{1}{${a}} \\sin(${a}x) + C`
                };
            },
            (rng) => { // e^x
                const a = getRandomInt(2, 4, rng) * (rng() > 0.5 ? 1 : -1);
                const b = getRandomInt(1, 5, rng);
                const bStr = b > 0 ? `+${b}` : `-${b}`;
                return {
                    id: `n3-${Date.now()}`,
                    type: "指数関数",
                    latex: `\\int e^{${a}x ${bStr}} \\, dx`,
                    hint: `合成関数の微分を考慮して係数調整。`,
                    answer: `\\frac{1}{${a}} e^{${a}x ${bStr}} + C`
                };
            },
            (rng) => { // f'/f
                const a = getRandomInt(1, 3, rng);
                return {
                    id: `n4-${Date.now()}`,
                    type: "対数型",
                    latex: `\\int \\frac{x}{x^2 + ${a}} \\, dx`,
                    hint: `分子が分母の微分に近い形（\\(f'/f\\)）。`,
                    answer: `\\frac{1}{2} \\log(x^2 + ${a}) + C`
                };
            }
        ];

        // --- 難問 (Hard) ---
        const hardGenerators = [
            (rng) => { // 部分分数分解 1/(x^2 - a^2)
                const a = getRandomInt(2, 5, rng);
                const aa = a * a;
                return {
                    id: `h1-${Date.now()}`,
                    type: "★難問（分数関数）",
                    latex: `\\int \\frac{1}{x^2 - ${aa}} \\, dx`,
                    hint: `分母を因数分解して、部分分数分解を行います。\\(\\frac{1}{x^2-a^2} = \\frac{1}{2a}(\\frac{1}{x-a} - \\frac{1}{x+a})\\) を利用。`,
                    answer: `\\frac{1}{${2*a}} \\log \\left| \\frac{x-${a}}{x+${a}} \\right| + C`
                };
            },
            (rng) => { // 部分積分（対数） log(ax)
                const a = getRandomInt(2, 5, rng);
                return {
                    id: `h2-${Date.now()}`,
                    type: "★難問（対数）",
                    latex: `\\int \\log(${a}x) \\, dx`,
                    hint: `\\(1 \\cdot \\log(${a}x)\\) と見て部分積分を行います。`,
                    answer: `x \\log(${a}x) - x + C`
                };
            },
            (rng) => { // 2回部分積分 x^2 e^x
                return {
                    id: `h3-${Date.now()}`,
                    type: "★難問（部分積分）",
                    latex: `\\int x^2 e^x \\, dx`,
                    hint: `次数を下げるために、部分積分を2回繰り返します。`,
                    answer: `(x^2 - 2x + 2)e^x + C`
                };
            },
            (rng) => { // tan^3 x
                return {
                    id: `h_tan3-${Date.now()}`,
                    type: "★難問（三角関数）",
                    latex: `\\int \\tan^3 x \\, dx`,
                    hint: `\\(\\tan^3 x = \\tan x (\\tan^2 x) = \\tan x (\\frac{1}{\\cos^2 x} - 1)\\) と変形します。前半は \\(\\tan x = t\\) と置換、後半は公式通りです。`,
                    answer: `\\frac{1}{2} \\tan^2 x + \\log |\\cos x| + C`
                };
            },
            (rng) => { // 1 / (1 + e^x)
                return {
                    id: `h_exp_frac-${Date.now()}`,
                    type: "★難問（指数関数）",
                    latex: `\\int \\frac{1}{1 + e^x} \\, dx`,
                    hint: `分子と分母に \\(e^{-x}\\) を掛けるか、分子を \\(1 = (1+e^x) - e^x\\) と変形します。`,
                    answer: `x - \\log(1 + e^x) + C`
                };
            },
            (rng) => { // x^3 e^{x^2}
                return {
                    id: `h_sub_parts-${Date.now()}`,
                    type: "★難問（複合）",
                    latex: `\\int x^3 e^{x^2} \\, dx`,
                    hint: `\\(x^2 = t\\) と置換すると \\(x^3 dx = x^2 \\cdot x dx = t \\cdot \\frac{1}{2} dt\\) となり、\\(\\int t e^t dt\\) の部分積分に帰着します。`,
                    answer: `\\frac{1}{2} e^{x^2} (x^2 - 1) + C`
                };
            },
            (rng) => { // 三角関数3乗 sin^3 x
                const isSin = rng() > 0.5;
                const func = isSin ? "sin" : "cos";
                const invFunc = isSin ? "cos" : "sin";
                return {
                    id: `h4-${Date.now()}`,
                    type: "★難問（三角関数）",
                    latex: `\\int \\${func}^3 x \\, dx`,
                    hint: `\\(\\${func}^2 x = 1 - \\${invFunc}^2 x\\) を利用して、\\(\\${func} x\\) を1つだけ分離します。`,
                    answer: isSin 
                        ? `- \\cos x + \\frac{1}{3} \\cos^3 x + C`
                        : `\\sin x - \\frac{1}{3} \\sin^3 x + C`
                };
            }
        ];

        // --- Components ---

        // 数式を1つ表示するコンポーネント (inline対応)
        const MathDisplay = ({ latex, isHard, inline = false }) => {
            const containerRef = useRef(null);
            useEffect(() => {
                if (window.katex && containerRef.current) {
                    try {
                        window.katex.render(latex, containerRef.current, {
                            throwOnError: false,
                            displayMode: !inline, // inlineならfalse
                            macros: { "\\C": "C" }
                        });
                    } catch (e) { console.error(e); }
                }
            }, [latex, inline]);
            
            const baseClass = inline ? "inline-block mx-1" : `py-4 text-2xl md:text-3xl block text-center`;
            const colorClass = isHard ? 'text-red-100' : 'text-slate-800';
            // inline時は親の色を継承させるためcolorClassを適用しない
            
            return <span ref={containerRef} className={`${baseClass} ${!inline ? colorClass : ''}`}></span>;
        };

        // 文章と数式が混ざったテキストをパースして表示するコンポーネント
        const ParsedMathText = ({ text, isHard }) => {
            if (!text) return null;
            // \( ... \) で囲まれた部分を分割する
            const parts = text.split(/\\\((.*?)\\\)/g);
            return (
                <span className={isHard ? 'text-yellow-200' : 'text-yellow-900'}>
                    {parts.map((part, i) => {
                        // 偶数番目はテキスト、奇数番目は数式
                        if (i % 2 === 1) {
                            return <MathDisplay key={i} latex={part} isHard={isHard} inline={true} />;
                        }
                        return <span key={i}>{part}</span>;
                    })}
                </span>
            );
        };

        const Icon = ({ name, className, size = 20 }) => {
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        // --- Main App ---

        function App() {
            const [problem, setProblem] = useState(null);
            const [showHint, setShowHint] = useState(false);
            const [showAnswer, setShowAnswer] = useState(false);
            const [mode, setMode] = useState('daily'); // daily, random, hard, stats, saved
            const [isCurrentSolved, setIsCurrentSolved] = useState(false); 
            
            const [userData, setUserData] = useState({
                history: {}, 
                totalSolved: 0,
                streak: 0,
                lastSolvedDate: null,
                savedProblems: []
            });

            useEffect(() => {
                const savedData = localStorage.getItem('integral_master_data_v3');
                if (savedData) setUserData(JSON.parse(savedData));
                lucide.createIcons();
                loadDailyProblem();
            }, []);

            useEffect(() => {
                lucide.createIcons();
                localStorage.setItem('integral_master_data_v3', JSON.stringify(userData));
                
                // Theme switching
                if (mode === 'hard') {
                    document.body.classList.add('bg-slate-900', 'text-white');
                    document.body.classList.remove('bg-slate-50', 'text-slate-900');
                } else {
                    document.body.classList.add('bg-slate-50', 'text-slate-900');
                    document.body.classList.remove('bg-slate-900', 'text-white');
                }
            }, [userData, mode]);

            const loadDailyProblem = () => {
                setMode('daily');
                resetView();
                const today = new Date().toISOString().slice(0, 10);
                const seeder = new Seeder(today);
                const rng = () => seeder.random();
                const genIndex = Math.floor(rng() * normalGenerators.length);
                const p = normalGenerators[genIndex](rng);
                p.isDaily = true;
                setProblem(p);
            };

            const loadRandomProblem = () => {
                setMode('random');
                resetView();
                const rng = Math.random;
                const genIndex = Math.floor(rng() * normalGenerators.length);
                setProblem(normalGenerators[genIndex](rng));
            };

            const loadHardProblem = () => {
                setMode('hard');
                resetView();
                const rng = Math.random;
                const genIndex = Math.floor(rng() * hardGenerators.length);
                const p = hardGenerators[genIndex](rng);
                p.isHard = true; 
                setProblem(p);
            };

            const resetView = () => {
                setShowHint(false);
                setShowAnswer(false);
                setIsCurrentSolved(false);
            };

            const markAsSolved = () => {
                if (!problem) return;
                
                confetti({
                    particleCount: mode === 'hard' ? 200 : 100,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: mode === 'hard' ? ['#ef4444', '#f87171', '#ffffff'] : undefined
                });

                const today = new Date().toISOString().slice(0, 10);
                const newUserData = { ...userData };
                newUserData.totalSolved += 1;
                
                if (!newUserData.history[today]) {
                    newUserData.history[today] = true;
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yStr = yesterday.toISOString().slice(0, 10);
                    if (newUserData.lastSolvedDate === yStr) {
                        newUserData.streak += 1;
                    } else if (newUserData.lastSolvedDate !== today) {
                        newUserData.streak = 1;
                    }
                    newUserData.lastSolvedDate = today;
                }
                setUserData(newUserData);
                setIsCurrentSolved(true);
            };

            const toggleSaveProblem = () => {
                const newUserData = { ...userData };
                const index = newUserData.savedProblems.findIndex(p => p.latex === problem.latex);
                if (index >= 0) newUserData.savedProblems.splice(index, 1);
                else newUserData.savedProblems.push(problem);
                setUserData(newUserData);
            };

            const isSaved = problem && userData.savedProblems.some(p => p.latex === problem.latex);
            const isDailySolved = userData.history[new Date().toISOString().slice(0, 10)];
            const isHardMode = mode === 'hard';

            return (
                <div className={`min-h-screen pb-24 md:pb-10 font-sans ${isHardMode ? 'bg-slate-950 text-red-50' : 'bg-slate-50 text-slate-900'}`}>
                    
                    {/* Header */}
                    <header className={`${isHardMode ? 'bg-slate-900 border-red-900/30' : 'bg-white border-slate-200'} border-b sticky top-0 z-20 transition-colors`}>
                        <div className="max-w-2xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className={`p-2 rounded-lg shadow-sm ${isHardMode ? 'bg-red-600' : 'bg-indigo-600'}`}>
                                    <Icon name={isHardMode ? "flame" : "sigma"} className="text-white" />
                                </div>
                                <div>
                                    <h1 className="font-bold text-lg leading-tight tracking-tight">積分マスター</h1>
                                    <p className={`text-[10px] font-medium ${isHardMode ? 'text-red-400' : 'text-slate-500'}`}>Day {userData.streak} 継続中</p>
                                </div>
                            </div>
                            <button onClick={() => setMode('stats')} className={`p-2 rounded-full transition-colors relative ${isHardMode ? 'hover:bg-red-900/30' : 'hover:bg-slate-100'}`}>
                                <Icon name="trophy" className="text-yellow-500" />
                                {userData.totalSolved > 0 && <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>}
                            </button>
                        </div>
                    </header>

                    <main className="max-w-2xl mx-auto px-4 py-6 space-y-6">

                        {/* Navigation Tabs */}
                        <div className={`flex p-1 rounded-xl overflow-x-auto ${isHardMode ? 'bg-slate-900 border border-red-900/30' : 'bg-slate-200'}`}>
                            <button onClick={loadDailyProblem} className={`flex-1 py-2 px-3 rounded-lg text-xs font-bold flex items-center justify-center gap-1 transition-all whitespace-nowrap ${mode === 'daily' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}`}>
                                <Icon name="calendar" size={14} /> 今日
                            </button>
                            <button onClick={loadRandomProblem} className={`flex-1 py-2 px-3 rounded-lg text-xs font-bold flex items-center justify-center gap-1 transition-all whitespace-nowrap ${mode === 'random' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}`}>
                                <Icon name="dices" size={14} /> 演習
                            </button>
                            <button onClick={loadHardProblem} className={`flex-1 py-2 px-3 rounded-lg text-xs font-bold flex items-center justify-center gap-1 transition-all whitespace-nowrap ${mode === 'hard' ? 'bg-red-600 text-white shadow-sm' : (isHardMode ? 'text-red-400 hover:text-red-300' : 'text-slate-500 hover:text-red-500')}`}>
                                <Icon name="skull" size={14} /> 難問
                            </button>
                            <button onClick={() => setMode('saved')} className={`flex-1 py-2 px-3 rounded-lg text-xs font-bold flex items-center justify-center gap-1 transition-all whitespace-nowrap ${mode === 'saved' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500'}`}>
                                <Icon name="bookmark" size={14} /> 保存
                            </button>
                        </div>

                        {/* Content */}
                        {mode === 'stats' ? (
                            /* Stats View */
                            <div className="space-y-6 animate-in fade-in slide-in-from-bottom-4">
                                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 text-slate-900">
                                    <h2 className="font-bold text-lg mb-4 flex items-center gap-2">
                                        <Icon name="calendar-days" className="text-indigo-500" /> 学習記録
                                    </h2>
                                    <div className="text-center py-8">
                                        <p className="text-4xl font-black text-indigo-600">{userData.totalSolved}</p>
                                        <p className="text-sm text-slate-400">総正解数</p>
                                    </div>
                                </div>
                                <div className="text-center">
                                    <button onClick={loadDailyProblem} className="text-indigo-600 font-bold text-sm hover:underline">問題に戻る</button>
                                </div>
                            </div>
                        ) : mode === 'saved' ? (
                            /* Saved View */
                            <div className="space-y-4 animate-in fade-in">
                                <h2 className={`font-bold px-2 ${isHardMode ? 'text-red-200' : 'text-slate-700'}`}>保存した問題 ({userData.savedProblems.length})</h2>
                                {userData.savedProblems.length === 0 ? (
                                    <div className={`text-center py-12 rounded-2xl border border-dashed ${isHardMode ? 'text-slate-500 border-slate-800' : 'text-slate-400 bg-white border-slate-300'}`}>
                                        <p>保存された問題はありません</p>
                                    </div>
                                ) : (
                                    userData.savedProblems.map((p, i) => (
                                        <div key={i} className={`p-4 rounded-xl shadow-sm border relative group ${isHardMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-200'}`}>
                                            <span className={`text-[10px] px-2 py-1 rounded-full ${p.isHard ? 'bg-red-900/50 text-red-300' : 'bg-slate-100 text-slate-500'}`}>{p.type}</span>
                                            <div className="py-2 overflow-x-auto"><MathDisplay latex={p.latex} isHard={isHardMode} /></div>
                                            <div className={`mt-2 pt-2 border-t flex justify-between items-center ${isHardMode ? 'border-slate-800' : 'border-slate-100'}`}>
                                                <button onClick={() => { setProblem(p); setMode(p.isHard ? 'hard' : 'random'); resetView(); }} className="text-xs font-bold text-indigo-500 hover:underline">解き直す</button>
                                                <span className="text-[10px] opacity-50">Answer: Check in mode</span>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        ) : (
                            /* Problem View */
                            <div className={`rounded-3xl shadow-lg border overflow-hidden relative min-h-[400px] flex flex-col animate-in zoom-in-95 duration-300 ${isHardMode ? 'bg-slate-900 border-red-900/50 shadow-red-900/20' : 'bg-white border-slate-200'}`}>
                                
                                {/* Card Header */}
                                <div className="absolute top-0 left-0 w-full flex justify-between items-start p-5 z-10">
                                    <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold border ${isHardMode ? 'bg-red-950 text-red-300 border-red-900' : 'bg-slate-100 text-slate-600 border-slate-200'}`}>
                                        {problem?.type || "Loading..."}
                                    </span>
                                    <div className="flex gap-2">
                                        {mode === 'daily' && isDailySolved && (
                                            <span className="flex items-center gap-1 text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full border border-emerald-100">
                                                <Icon name="check-circle-2" size={12} /> 完了
                                            </span>
                                        )}
                                        <button onClick={toggleSaveProblem} className={`p-2 rounded-full transition-colors ${isSaved ? 'text-pink-500 bg-pink-50' : (isHardMode ? 'text-slate-600 hover:text-slate-400' : 'text-slate-300 hover:bg-slate-50')}`}>
                                            <Icon name="bookmark" className={isSaved ? "fill-pink-500" : ""} />
                                        </button>
                                    </div>
                                </div>

                                {/* Problem Body */}
                                <div className="flex-1 flex flex-col items-center justify-center p-8 mt-8">
                                    <p className={`text-xs font-bold tracking-widest uppercase mb-4 ${isHardMode ? 'text-red-500' : 'text-slate-400'}`}>
                                        {isHardMode ? 'WARNING: CHALLENGE MODE' : 'Challenge'}
                                    </p>
                                    {problem && <MathDisplay latex={problem.latex} isHard={isHardMode} />}
                                </div>

                                {/* Interaction Area */}
                                <div className={`border-t ${isHardMode ? 'bg-slate-950 border-slate-800' : 'bg-slate-50 border-slate-100'}`}>
                                    
                                    {/* Hint Area */}
                                    {showHint && (
                                        <div className={`p-4 border-b animate-in slide-in-from-top-2 ${isHardMode ? 'bg-yellow-900/20 border-yellow-900/30' : 'bg-yellow-50 border-yellow-100'}`}>
                                            <div className="flex gap-3">
                                                <Icon name="lightbulb" className="text-yellow-600 shrink-0 mt-1" />
                                                <div>
                                                    <p className="text-xs font-bold text-yellow-600 uppercase mb-1">ヒント</p>
                                                    <div className={`text-sm leading-relaxed ${isHardMode ? 'text-yellow-200' : 'text-yellow-900'}`}>
                                                        <ParsedMathText text={problem.hint} isHard={isHardMode} />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Answer Area */}
                                    {showAnswer && (
                                        <div className={`p-6 border-b animate-in fade-in ${isHardMode ? 'bg-red-950/30 border-red-900/30' : 'bg-indigo-50 border-indigo-100'}`}>
                                            <p className={`text-xs font-bold uppercase mb-2 text-center ${isHardMode ? 'text-red-400' : 'text-indigo-500'}`}>解答</p>
                                            <div className="flex justify-center scale-110"><MathDisplay latex={problem.answer} isHard={isHardMode} /></div>
                                            
                                            <div className="mt-6 text-center">
                                                {/* 完了ボタン or 次の問題へボタンの切り替え */}
                                                {!isCurrentSolved ? (
                                                    <button 
                                                        onClick={markAsSolved} 
                                                        className={`font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all flex items-center gap-2 mx-auto ${isHardMode ? 'bg-red-600 hover:bg-red-500 text-white shadow-red-900/50' : 'bg-indigo-600 hover:bg-indigo-500 text-white shadow-indigo-200'}`}
                                                    >
                                                        <Icon name="check" /> 理解した！ (完了)
                                                    </button>
                                                ) : (
                                                    (mode === 'random' || mode === 'hard') && (
                                                        <button 
                                                            onClick={() => mode === 'hard' ? loadHardProblem() : loadRandomProblem()} 
                                                            className={`font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-all flex items-center gap-2 mx-auto animate-pulse ${isHardMode ? 'bg-white text-red-900 hover:bg-red-100' : 'bg-slate-900 text-white hover:bg-slate-800'}`}
                                                        >
                                                            <Icon name="arrow-right" /> 次の問題へ
                                                        </button>
                                                    )
                                                )}
                                                {!isCurrentSolved && <p className="text-[10px] opacity-50 mt-2">実績に追加されます</p>}
                                            </div>
                                        </div>
                                    )}

                                    {/* Control Bar */}
                                    <div className={`grid grid-cols-2 gap-px ${isHardMode ? 'bg-slate-800' : 'bg-slate-200'}`}>
                                        <button 
                                            onClick={() => setShowHint(!showHint)}
                                            className={`p-4 flex items-center justify-center gap-2 text-sm font-bold transition-colors ${isHardMode ? 'bg-slate-900 text-slate-400 hover:bg-slate-800' : 'bg-white text-slate-600 hover:bg-slate-50'}`}
                                        >
                                            <Icon name="lightbulb" size={18} className={showHint ? "fill-yellow-400 text-yellow-400" : ""} />
                                            {showHint ? 'ヒントを隠す' : 'ヒント'}
                                        </button>
                                        <button 
                                            onClick={() => setShowAnswer(!showAnswer)}
                                            className={`p-4 flex items-center justify-center gap-2 text-sm font-bold transition-colors ${
                                                showAnswer 
                                                    ? (isHardMode ? 'bg-red-950 text-red-200' : 'bg-slate-800 text-white') 
                                                    : (isHardMode ? 'bg-slate-900 text-red-400 hover:bg-slate-800' : 'bg-white text-indigo-600 hover:bg-slate-50')
                                            }`}
                                        >
                                            {showAnswer ? <><Icon name="eye-off" size={18} /> 閉じる</> : <><Icon name="eye" size={18} /> 答えを見る</>}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>