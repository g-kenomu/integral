<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>

</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI性格診断神社</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;700;800&family=Zen+Old+Mincho:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Shippori Mincho', serif; 
            background-color: #fcf9f2;
            background-image: url("https://www.transparenttextures.com/patterns/washi.png");
        }

        .vertical-text {
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.2em;
        }

        .shrine-red { color: #c0392b; }
        .shrine-bg { background-color: #c0392b; }

        /* おみくじアニメーション */
        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }
        .shake-anim { animation: shake 0.5s infinite; }

        @keyframes slide-down {
            0% { transform: translateY(-100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        .omikuji-appear { animation: slide-down 1s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* 和紙の質感カード */
        .washi-card {
            background-color: #fffbf0;
            background-image: url("https://www.transparenttextures.com/patterns/washi.png");
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="min-h-screen text-slate-800 flex flex-col items-center py-8 px-4 relative overflow-x-hidden">

    <!-- 背景装飾（鳥居風） -->
    <div class="fixed top-0 left-0 w-8 h-full bg-red-800/10 z-0 pointer-events-none"></div>
    <div class="fixed top-0 right-0 w-8 h-full bg-red-800/10 z-0 pointer-events-none"></div>
    <div class="fixed top-4 left-0 right-0 h-4 bg-red-800/10 z-0 pointer-events-none"></div>

    <!-- Main Container -->
    <main class="w-full max-w-lg z-10 flex flex-col items-center gap-8">
        
        <!-- Title -->
        <header class="text-center space-y-2">
            <div class="inline-block border-4 border-red-700 p-1 rounded-sm mb-2">
                <div class="border border-red-700 px-4 py-2 bg-white/80">
                    <h1 class="text-3xl font-black text-red-800 tracking-widest font-serif">電脳性格診断神社</h1>
                </div>
            </div>
            <p class="text-sm text-slate-600 font-bold">AIの神様が、あなたの本性を暴きます</p>
        </header>

        <!-- Input Screen -->
        <div id="screen-input" class="w-full transition-all duration-500">
            <div class="washi-card p-6 rounded-lg border-t-8 border-red-700 relative">
                <!-- 鈴緒（すずお） -->
                <div class="absolute -top-16 left-1/2 -translate-x-1/2 flex flex-col items-center group cursor-pointer" onclick="playBell()">
                    <div class="w-4 h-32 bg-gradient-to-b from-yellow-100 to-yellow-600 rounded-full shadow-lg border border-yellow-700"></div>
                    <div class="w-16 h-16 rounded-full bg-yellow-500 border-4 border-yellow-700 shadow-xl flex items-center justify-center -mt-2 group-active:scale-110 transition-transform">
                        <div class="w-12 h-1 bg-yellow-900 rounded-full opacity-50"></div>
                    </div>
                    <p class="mt-2 text-xs font-bold text-red-800 bg-white/80 px-2 rounded">音が出ます</p>
                </div>

                <div class="mt-12 text-center space-y-6">
                    <p class="text-lg font-bold text-slate-700 leading-loose">
                        そなたの特徴、悩み、<br>
                        あるいは日頃の行いを<br>
                        この奉納紙に記すがよい。
                    </p>

                    <div class="relative">
                        <textarea id="user-input" 
                            class="w-full h-40 bg-white border-2 border-slate-300 rounded-sm p-4 font-serif text-lg focus:outline-none focus:border-red-700 focus:ring-1 focus:ring-red-700 transition-colors resize-none vertical-text mx-auto block shadow-inner"
                            placeholder="（例）&#10;最近、つい夜更かしをして動画を見てしまう。&#10;人見知りだが、仲良くなるとうるさいと言われる。&#10;貯金ができない。"
                        ></textarea>
                        <!-- 筆アイコン -->
                        <div class="absolute bottom-2 right-2 text-slate-300 pointer-events-none">
                            <i data-lucide="pen-tool" class="w-6 h-6"></i>
                        </div>
                    </div>

                    <button onclick="submitPrayer()" class="w-full bg-red-700 hover:bg-red-800 text-white text-xl font-bold py-4 rounded-sm shadow-lg border-b-4 border-red-900 active:translate-y-1 active:border-b-0 transition-all flex items-center justify-center gap-2 group">
                        <i data-lucide="scroll" class="w-6 h-6"></i>
                        <span>診断を奉納する</span>
                    </button>
                    <p class="text-xs text-slate-500">※AI神が忖度なしに分析します</p>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="screen-loading" class="hidden w-full text-center py-20">
            <div class="mb-8 relative inline-block">
                <div class="w-32 h-48 bg-red-700 border-4 border-yellow-500 mx-auto shake-anim flex items-center justify-center shadow-xl">
                    <span class="vertical-text text-white font-bold text-2xl">電脳みくじ</span>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-slate-700 mb-2">祈祷中...</h2>
            <p class="text-slate-500 animate-pulse">AI神があなたの深層心理にアクセスしています</p>
        </div>

        <!-- Result Screen -->
        <div id="screen-result" class="hidden w-full transition-all duration-500">
            <div class="omikuji-appear washi-card p-2 rounded-sm shadow-2xl relative overflow-hidden">
                <!-- 装飾枠 -->
                <div class="border-2 border-red-800 p-6 flex flex-col items-center gap-6 relative">
                    
                    <!-- 運勢 -->
                    <div class="text-center">
                        <p class="text-sm font-bold text-slate-500 mb-2">― 運勢 ―</p>
                        <h2 id="result-luck" class="text-5xl font-black text-red-700 font-serif mb-4">大吉</h2>
                        <div class="w-16 h-1 bg-red-700 mx-auto"></div>
                    </div>

                    <!-- 一言（縦書き） -->
                    <div class="h-64 flex flex-row-reverse justify-center items-start gap-6 border-y border-slate-200 py-4 w-full bg-white/50">
                        <p id="result-word" class="vertical-text text-2xl font-bold text-slate-800 leading-loose h-full">
                            ここに神のお告げが入る
                        </p>
                    </div>

                    <!-- 詳細分析 -->
                    <div class="w-full space-y-4 text-left bg-white p-4 rounded border border-slate-200">
                        <div class="flex items-start gap-3">
                            <i data-lucide="user-search" class="w-6 h-6 text-red-700 shrink-0 mt-1"></i>
                            <div>
                                <h3 class="font-bold text-red-800 text-sm mb-1">【性格見抜】</h3>
                                <p id="result-analysis" class="text-sm text-slate-700 leading-relaxed">
                                    分析テキストがここに入ります。
                                </p>
                            </div>
                        </div>
                        <div class="h-px w-full bg-slate-200"></div>
                        <div class="flex items-start gap-3">
                            <i data-lucide="sparkles" class="w-6 h-6 text-yellow-600 shrink-0 mt-1"></i>
                            <div>
                                <h3 class="font-bold text-yellow-700 text-sm mb-1">【開運の鍵】</h3>
                                <p id="result-advice" class="text-sm text-slate-700 leading-relaxed">
                                    アドバイスがここに入ります。
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- アイテム -->
                    <div class="flex justify-center items-center gap-4 bg-red-50 px-6 py-3 rounded-full border border-red-100">
                        <span class="text-xs font-bold text-red-400">ラッキーアイテム</span>
                        <span id="result-item" class="text-lg font-bold text-red-800">金のキーボード</span>
                    </div>

                    <button onclick="resetApp()" class="mt-4 text-slate-400 hover:text-red-600 text-sm font-bold flex items-center gap-1 transition-colors">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        もう一度引く
                    </button>
                </div>
            </div>
        </div>

    </main>

    <footer class="mt-12 text-center text-xs text-slate-400 font-serif z-10">
        <p>Copyright © 2026 電脳性格診断神社</p>
    </footer>

    <script>
        const apiKey = ""; // API key is handled by the environment

        // --- Sound Engine (Web Audio API) ---
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // 神々しい効果音（キラキラ音 + 重厚な和音）
        function playDivineSound() {
            initAudio();
            const now = audioCtx.currentTime;
            
            // Major Chord (C, E, G, C) + Sparkling highs
            const freqs = [261.63, 329.63, 392.00, 523.25, 1046.50, 2093.00];
            
            freqs.forEach((f, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = i > 3 ? 'sine' : 'triangle'; // Highs are sine, Lows are triangle
                osc.frequency.value = f;
                
                // Envelope
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(i > 3 ? 0.05 : 0.1, now + 0.1); // Attack
                gain.gain.exponentialRampToValueAtTime(0.001, now + 4.0); // Long decay
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.start(now);
                osc.stop(now + 4.0);
            });
        }

        // 鈴の音（ガラガラ音）
        function playShakeSound() {
            initAudio();
            const now = audioCtx.currentTime;
            
            // Generate multiple short, dissonant high-pitched sounds
            for(let i=0; i<5; i++) {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = 'square';
                // Random frequencies for bell-like noise
                osc.frequency.value = 2000 + Math.random() * 1000; 
                
                const start = now + Math.random() * 0.2;
                
                gain.gain.setValueAtTime(0, start);
                gain.gain.linearRampToValueAtTime(0.05, start + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, start + 0.3);
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.start(start);
                osc.stop(start + 0.3);
            }
        }

        // --- Application Logic ---

        function playBell() {
            playShakeSound(); // 音を鳴らす
            
            const bell = document.querySelector('.bg-gradient-to-b');
            bell.parentElement.classList.add('shake-anim');
            setTimeout(() => {
                bell.parentElement.classList.remove('shake-anim');
            }, 500);
        }

        async function submitPrayer() {
            // ユーザー操作時にオーディオコンテキストを確実に初期化
            initAudio();
            
            const input = document.getElementById('user-input').value.trim();
            if (!input) {
                alert("まずはそなたの特徴を記すがよい。");
                return;
            }

            // 画面遷移
            document.getElementById('screen-input').classList.add('hidden');
            document.getElementById('screen-loading').classList.remove('hidden');

            try {
                // Gemini API Call
                const prompt = `
                    ユーザーが自分の特徴や悩みとして以下のテキストを入力しました：
                    「${input}」

                    あなたは神社の少し毒舌だが本質を突く「AI神」です。
                    以下のフォーマットのJSONで、性格診断おみくじの結果を生成してください。
                    JSON以外の余計な文字（Markdownのバッククォートなど）は含めないでください。

                    {
                        "luck": "大吉/中吉/小吉/吉/末吉/凶/大凶 のいずれか",
                        "word": "短くパンチのある、縦書きに合うお告げの一言（20文字以内）",
                        "analysis": "ユーザーの性格を鋭く分析した文章（辛口でユーモアを交えて）",
                        "advice": "具体的でちょっと変わった開運アドバイス",
                        "item": "ラッキーアイテム（現代的なものやシュールなもの）"
                    }
                `;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });

                const data = await response.json();
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                const result = JSON.parse(text);

                // 結果の反映
                document.getElementById('result-luck').innerText = result.luck;
                document.getElementById('result-word').innerText = result.word;
                document.getElementById('result-analysis').innerText = result.analysis;
                document.getElementById('result-advice').innerText = result.advice;
                document.getElementById('result-item').innerText = result.item;

                // 運勢による色の変化（簡易）
                const luckEl = document.getElementById('result-luck');
                if (result.luck.includes('凶')) {
                    luckEl.className = "text-5xl font-black text-slate-700 font-serif mb-4";
                } else {
                    luckEl.className = "text-5xl font-black text-red-700 font-serif mb-4";
                }

                // 画面遷移 & 効果音
                document.getElementById('screen-loading').classList.add('hidden');
                document.getElementById('screen-result').classList.remove('hidden');
                
                // 神々しい音を再生！
                playDivineSound();

            } catch (e) {
                console.error(e);
                alert("神との通信に失敗しました。もう一度お試しください。");
                resetApp();
            }
        }

        function resetApp() {
            document.getElementById('user-input').value = '';
            document.getElementById('screen-result').classList.add('hidden');
            document.getElementById('screen-loading').classList.add('hidden');
            document.getElementById('screen-input').classList.remove('hidden');
        }

        lucide.createIcons();
    </script>
</body>
</html>